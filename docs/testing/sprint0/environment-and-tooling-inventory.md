# Scam Dunk – Environment & Tooling Inventory
_Phase 0 validation snapshot generated by autonomous remediation lead on 2025‑05‑13._

---

## 1. Owner & Access Matrix
| Area | Primary Owner | Backup Owner | Access Scope | Notes |
| --- | --- | --- | --- | --- |
| Backend API (`packages/api`) | Backend Lead (Phase 0) | DevOps Lead | Supabase service role, Postgres credentials, CI deploy tokens | Owns auth/telemetry interfaces and migrations. |
| Frontend Web (`packages/web`) | Frontend Lead | Backend Lead | Vercel project admin, Supabase anon key | Manages cookie auth UX and deployment approvals. |
| Infrastructure & Secrets | DevOps Lead | Security Analyst | Vercel env editor, Supabase project admin | Maintains secret rotation runbooks and audits. |
| QA & Compliance | QA Partner | Security Analyst | Read-only Supabase, CI test dashboards | Signs off regression packs and evidence bundles. |

All owners authenticate via Vercel SSO and Supabase dashboard accounts; least-privilege roles are enforced (DevOps = Project Owner, others = Developer).

---

## 2. Secrets & Configuration Sources
| Secret | Live Location | Rotation Frequency | Retrieval | Notes |
| --- | --- | --- | --- | --- |
| `SUPABASE_SERVICE_ROLE_KEY` | Vercel env (`production`, `preview`) | 90 days or on incident | `vercel env pull --environment production` | Never committed; pulled during CI deploy. |
| `SUPABASE_ANON_KEY` | Vercel env (`production`, `preview`) | 180 days | Same as above | Mirrors Supabase regenerated anon key. |
| `SUPABASE_URL` | Vercel env | On Supabase project move | Static project URL `https://gcrkijxkecsfafjbojey.supabase.co`. |
| `DATABASE_URL` / `DIRECT_URL` | Vercel env | Rotate with DB password | `vercel env ls` + Supabase password reset | Uses pooled (`...pooler...:6543`) and direct (`...:5432`) variants. |
| `JWT_SECRET` | Vercel env | 90 days | `vercel env pull` | Keep in sync with API/edge functions. |
| `OPENAI_API_KEY` | Vercel env | Provider policy | `vercel env pull` | Required for analysis features. |

### Rotation Runbook (Supabase + Vercel)
1. Generate fresh keys in Supabase dashboard (Settings → API → “Generate new secret”).  
2. Update Vercel via CLI:  
   ```bash
   vercel env add SUPABASE_SERVICE_ROLE_KEY production
   vercel env add SUPABASE_SERVICE_ROLE_KEY preview
   ```  
   (Repeat for each secret; paste new values when prompted.)  
3. Invalidate cached secrets: redeploy API (`npm run deploy:api`) and web (`vercel deploy --prod`).  
4. Capture audit evidence: screenshot Supabase “Key last rotated” timestamps and Vercel env history.  
5. Remove old values from local terminals (`history -d`) and shred temporary files.

---

## 3. Runtime & Tooling Baseline
- **Node.js**: 18.19 LTS (local), upgrade path to 20 tracked in Phase 1.  
- **npm**: 10.5.x.  
- **API**: Express + Prisma (TypeScript). Start with `npm --prefix packages/api run dev`.  
- **Web**: Next.js 14.0.3. Start with `npm --prefix packages/web run dev`.  
- **Testing**:  
  - Unit/API: `npm --prefix packages/api test` (Jest).  
  - Lint: `npm --prefix packages/web run lint`.  
  - E2E (Playwright, hitting live Supabase): `npm --prefix packages/web run test:e2e`.  
- **CI/CD**: GitHub Actions workflows triggered on push; deploys to Vercel via `VERCEL_TOKEN`.  
- **Monitoring**: Prometheus scraper at `http://localhost:3001/metrics`; Alertmanager webhooks (to be validated in Phase 1).

---

## 4. Deployment Procedures
1. **Pre-flight**  
   - `npm install` at repo root.  
   - `npm --prefix packages/api run build` and `npm --prefix packages/web run build`.  
   - Ensure `.env` files are absent; rely on Vercel env injection.
2. **Trigger Deploy**  
   - Push to `main` → GitHub Action runs tests and invokes `vercel deploy --prod`.  
   - For hotfixes, run `vercel deploy --prebuilt --prod` locally (requires fresh build artifacts).  
3. **Post-deploy Validation**  
   - `npm --prefix packages/api run qa:live-check` (Phase 0 live check).  
   - Verify Prometheus targets in Grafana dashboard `Scam Dunk / Core Services`.  
   - Confirm Supabase audit log entries for new key usage.

---

## 5. Evidence & Artifacts
- Inventory generated 2025‑05‑13, stored here and referenced by `docs/testing/sprint3/executive-summary.md`.  
- Secrets validated via `vercel env pull` hash comparison (recorded in Phase 0 evidence bundle).  
- Supabase schema snapshot captured via `supabase db dump --project-ref gcrkijxkecsfafjbojey --file docs/testing/sprint0/schema-20250513.sql`.

---

### Outstanding Follow-ups
- Validate Alertmanager webhook destination (`ALERT_WEBHOOK_URL`) once Phase 1 telemetry alignment completes.  
- Confirm k6 scripts updated to consume secrets from environment instead of local `.env`.  
- Schedule next rotation window for 2025‑08‑11 (90 days).
